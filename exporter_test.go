package main

import "testing"

func TestParse(t *testing.T) {
	testJSON := []byte(`{"maps":[{"filename":"/etc/tirex/renderer/mapnik/osmcarto.conf","maxrequests":"50","mapfile":"/var/styles/openstreetmap-carto/osmcarto.xml","minz":0,"tiledir":"/var/lib/tirex/tiles/osm-carto","maxz":18,"name":"osm-carto","renderer":"mapnik"},{"renderer":"mapnik","name":"osm-carto@2x","tilesize":"512","maxrequests":"50","filename":"/etc/tirex/renderer/mapnik/osmcarto@2x.conf","mapfile":"/var/styles/openstreetmap-carto/osmcarto.xml","minz":0,"scalefactor":"2","maxz":18,"tiledir":"/var/lib/tirex/tiles/osm-carto@2x"}],"queue":{"maxsize":268,"size":265,"prioqueues":[{"prio":1,"size":0,"maxsize":1},{"maxsize":4,"size":0,"prio":25},{"age_first":6,"prio":99,"age_last":6,"maxsize":268,"size":265}]},"pid":58,"started":1648113317,"renderers":[{"syslog_facility":"daemon","procs":3,"debug":0,"plugindir":"/usr/lib/mapnik/3.0/input","name":"mapnik","fontdir":"/usr/share/fonts/","fontdir_recurse":"1","port":9331,"path":"/usr/lib/tirex/backends/mapnik","maps":["osm-carto","osm-carto@2x"]}],"updated":1648119539,"rm":{"buckets":[{"maxproc":10,"can_render":true,"maxload":30,"maxprio":9,"numproc":0,"minprio":1,"name":"live","active":1},{"numproc":0,"maxprio":19,"minprio":10,"maxproc":8,"can_render":true,"maxload":24,"active":1,"name":"important"},{"name":"background","active":1,"can_render":false,"maxproc":6,"maxload":20,"maxprio":0,"numproc":6,"minprio":20}],"rendering":[{"age":6,"x":64576,"prio":99,"z":17,"map":"osm-carto","y":43592},{"y":43592,"map":"osm-carto@2x","x":64576,"age":6,"z":17,"prio":99},{"z":17,"prio":99,"x":64568,"age":6,"y":43592,"map":"osm-carto@2x"},{"y":43592,"map":"osm-carto","prio":99,"z":17,"x":64584,"age":3},{"age":1,"x":64584,"z":17,"prio":99,"map":"osm-carto@2x","y":43592},{"age":1,"x":64592,"prio":99,"z":17,"y":43592,"map":"osm-carto"}],"load":3.51,"num_rendering":6,"stats":{"count_error":14,"count_timeouted":2,"count_requested":38,"count_expired":0,"count_rendered":{"osm-carto":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1],"osm-carto@2x":[null,1,null,null,null,null,null,null,null,1,2,4,4,5,3,6,1,2,2]},"sum_render_time":{"osm-carto":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,3178],"osm-carto@2x":[null,190894,null,null,null,null,null,null,null,3872,65039,99543,58182,38631,12221,66744,4514,8361,8192]}}}}`)

	parseTirexOutput(testJSON)
}
